<body>
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #333;
    }

    #canvas {
        border: 1px solid;
        width: 100%;
        height: 100%;
    }
</style>
<canvas id="canvas"></canvas>
<img src="textures/UV_Grid_Lrg.jpg" id="imgTex" hidden/>

<img src="textures/miramar_right.png" id="cube01_right" hidden>
<img src="textures/miramar_left.png" id="cube01_left" hidden>
<img src="textures/miramar_top.png" id="cube01_top" hidden>
<img src="textures/miramar_bottom.png" id="cube01_bottom" hidden>
<img src="textures/miramar_back.png" id="cube01_back" hidden>
<img src="textures/miramar_front.png" id="cube01_front" hidden>

<img src="textures/grimmnight_right.png" id="cube02_right" hidden>
<img src="textures/grimmnight_left.png" id="cube02_left" hidden>
<img src="textures/grimmnight_top.png" id="cube02_top" hidden>
<img src="textures/grimmnight_bottom.png" id="cube02_bottom" hidden>
<img src="textures/grimmnight_back.png" id="cube02_back" hidden>
<img src="textures/grimmnight_front.png" id="cube02_front" hidden>

<script id="vertex_shader" type="x-shader/x-vertex">#version 300 es
    in vec4 a_position;
    in vec3 a_norm;
    in vec2 a_uv;

    uniform mat4 uPMatrix;
    uniform mat4 uMVMatrix;
    uniform mat4 uCameraMatrix;
    uniform mat3 uNormMatrix;
    uniform vec3 uCamPos;

    out vec3 vPos;
    out vec3 vNorm;
    out vec3 vCamPos;
    out highp vec2 vUV;

    void main(void){
        // Setup some fragment vars
        vec4 pos = uMVMatrix * vec4(a_position.xyz, 1.0); // Need position in world space
        vPos = pos.xyz;
        vNorm = uNormMatrix * a_norm; // Nedd Norm Scaled/Rotated correctly
        vUV = a_uv;
        vCamPos = (inverse(uCameraMatrix) * vec4(uCamPos, 1.0)).xyz; // Need to Move CameraPos into wolrd space for specular calculation

        gl_Position = uPMatrix * uCameraMatrix * pos;
    }
</script>
<script id="fragment_shader" type="x-shader/x-fragment">#version 300 es
    precision mediump float;

    uniform sampler2D uMainTex;
    uniform vec3 uLightPos;

    in vec3 vPos;
    in vec3 vNorm;
    in vec3 vCamPos;
    in highp vec2 vUV;

    out vec4 outColor;
    void main(void){
        // Setup basic Colors
//        vec4 cBase = vec4(1.0, 0.5, 0.5, 1.0); // Texture (uMainTex, vUV)
        vec4 cBase = texture(uMainTex, vUV);
        vec3 cLight = vec3(1.0, 1.0, 1.0); // The color of light

        // Setup ambient lighting
        float ambientStrength = 0.15;
        vec3 cAmbient = ambientStrength * cLight;

        // Setup diffuse lighting
        vec3 lightDir = normalize(uLightPos - vPos);

        float diffAngle = max(dot(vNorm, lightDir), 0.0);
        float diffuseStrength = 0.3;

        vec3 cDiffuse = diffAngle * cLight * diffuseStrength;

        // Setup specular lighting
        float specularStrength = 0.2;
        float specularShininess = 1.0;

        vec3 camDir = normalize(vCamPos - vPos);
        vec3 reflectDir = reflect(-lightDir, vNorm);

        float spec = pow(max(dot(reflectDir, camDir), 0.0), specularShininess);
        vec3 cSpecular = specularStrength * spec * cLight;

        // Final
        vec3 finalColor = (cAmbient + cDiffuse + cSpecular) * cBase.rgb; // Combined light strength applied it to the base color
        outColor = vec4(finalColor, 1.0);
    }

</script>
<script type="text/plain" id="obj_file">
# Blender v2.76 (sub 0) OBJ File: 'cube.blend'
# www.blender.org
mtllib cube.mtl
o Cube
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
v 1.000000 1.000000 -0.999999
v 0.999999 1.000000 1.000001
v -1.000000 1.000000 1.000000
v -1.000000 1.000000 -1.000000
vt 1.000000 1.000000
vt 0.000000 1.000000
vt 0.000000 0.000000
vt 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 0.000000 1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -0.000000 0.000000 1.000000
vn -1.000000 -0.000000 -0.000000
vn 0.000000 0.000000 -1.000000
usemtl Material
s off
f 2/1/1 3/2/1 4/3/1
f 8/2/2 7/3/2 6/4/2
f 5/1/3 6/2/3 2/3/3
f 6/1/4 7/2/4 3/3/4
f 3/4/5 7/1/5 8/2/5
f 1/3/6 4/4/6 8/1/6
f 1/4/1 2/1/1 4/3/1
f 5/1/2 8/2/2 6/4/2
f 1/4/3 5/1/3 2/3/3
f 2/4/4 6/1/4 3/3/4
f 4/3/5 3/4/5 8/2/5
f 5/2/6 1/3/6 8/1/6
</script>

<script src="gl.js"></script>
<script src="shader.js"></script>
<script src="renderloop.js"></script>
<script src="model.js"></script>
<script src="primitives.js"></script>
<script src="math.js"></script>
<script src="transform.js"></script>
<script src="camera.js"></script>
<script src="shader_extra.js"></script>
<script src="skymap.js"></script>
<script src="gridfloor.js"></script>
<script src="objloader.js"></script>
<script src="debug.js"></script>
<script src="index.js"></script>
</body>
